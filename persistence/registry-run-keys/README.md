# Registry Run Keys

## Instructions

- Compile the payload

```bash
g++ payload.cpp -o payload.exe
```

- Edit `persist.cpp` by setting the payload variable with the actual path to your payload executable

- Compile the persistence program

```bash
g++ persist.cpp -o persist.exe
```

- Run `persist.exe` in order to add `payload.exe` to the registry

```bash
./persist.exe
```

- Log out then log in again

## Result

We get a popup messagebox indicating successful execution of our payload

## Further steps

### Establish system-wide persistence

- Edit `persist.exe` to use `HKEY_LOCAL_MACHINE` instead of `HKEY_CURRENT_USER`
- The payload will now be executed each time the system is rebooted, regardless of the logged in user
- This requires administrator privileges

### Establish only one-time persistence

- The payload will be executed upon the next reboot or login and never again
- Use the `RunOnce` key instead of the `Run` key
